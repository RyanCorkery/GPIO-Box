<html>

<head>
<meta http-equiv="Content-Language" content="nl">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<title>GPIO Box REV 2</title>
<style>
h1 {
    text-align: center;
}
.grid-container{
    padding: 15px;
    display: grid;
    justify-content: start;
    grid-gap: 10px;
    /* padding: 10px; */
    grid-auto-flow: column;
    grid-template-columns: auto;
}
.grid-container > div > div > input{
    justify-self: left;
}
.labels > div{
    padding: 5px;
    width: 70px;
    height: 20px;
}
.step > div{
    padding: 5px;
    height: 20px;
}
.step > div > input{
    width: 35px;
}
#form_data{
    width: 500px;;
}
</style>
</head>


<body>

<h1>GPIO Box REV 2</h1>

Program Number: <input id="program"><br><br>

<input type="button" value="Add Step" onclick="add_step()">
<input type="button" value="Remove Step" onclick="remove_step()"><br>

<div id="step_data" class="grid-container">
    <div class="Labels">
        <div>Break 1</div>
        <div>Break 2</div>
        <div>Break 3</div>
        <div>Break 4</div>
        <div>Break 5</div>
        <div>Break 6</div>
        <div>Break 7</div>
        <div>Break 8</div>
        <div>Speed 1</div>
        <div>Speed 2</div>
        <div>Speed 3</div>
        <div>Speed 4</div>
        <div>Speed 5</div>
        <div>Speed 6</div>
        <div>Speed 7</div>
        <div>Speed 8</div>
    </div>
    <div id="step_0" class="step">
        <div><input type="checkbox"></div>
        <div><input type="checkbox"></div>
        <div><input type="checkbox"></div>
        <div><input type="checkbox"></div>
        <div><input type="checkbox"></div>
        <div><input type="checkbox"></div>
        <div><input type="checkbox"></div>
        <div><input type="checkbox"></div>
        <div><input type="text" value="0"></div>
        <div><input type="text" value="0"></div>
        <div><input type="text" value="0"></div>
        <div><input type="text" value="0"></div>
        <div><input type="text" value="0"></div>
        <div><input type="text" value="0"></div>
        <div><input type="text" value="0"></div>
        <div><input type="text" value="0"></div>
    </div>
</div>


<form id="my_form" method="post" action="/" name="pins" onsubmit="save_data()">
    <input type="submit" value="Save program">
    <input id="form_data" type="text" name="step_0_data" value="00000000000000000000000000000000000000">
</form>



<input type="button" value="Test Save" onclick="save_data()">

<script>
    function save_data(){
        var number_of_steps = document.getElementById("step_data").children.length - 1;                               // Count number of steps in program
        document.getElementById("program").value = number_of_steps;                             // ******* TESTING

        var checkboxes = document.getElementsByTagName('input');
        var value;
        for (var x = 0; x < number_of_steps; x++){                                                                  // Loop through steps
            for (var i = x*8; i < checkboxes.length; i++) {                                                         // Loop through checkboxes in each step
                if (checkboxes[i].type === 'checkbox') {
                    if (checkboxes[i].checked){
                        value = checkboxes[i].value;    
                        var original = document.getElementById("my_form").children[x+1].value;
                        var new_string = replaceChar(original, '1', i);
                        document.getElementById("my_form").children[x+1].value = new_string;
                    }   
                }
            }
        }
    }

    function replaceChar(origString, replaceChar, index) {
        let firstPart = origString.substr(0, index);
        let lastPart = origString.substr(index + 1);
        
        let newString = firstPart + replaceChar + lastPart;
        return newString;
    }

    function add_step(){
        var original = document.getElementById("step_0");
        var clone = original.cloneNode(true);
        clone.id = "";
        original.parentNode.appendChild(clone);

        var original_data = document.getElementById("form_data");
        var clone_data = original_data.cloneNode(true);
        clone.id = "";
        original_data.parentNode.appendChild(clone_data);
    }

    function remove_step(){
        var count = document.getElementById("step_data").children.length;

        if (count > 2){
            let remove = document.getElementById("step_data");
            remove.removeChild(remove.lastChild);
        }
    }

</script>
</body>
</html>
